suite: featurebyte-api

tests:
  - it: api deployment exists
    template: fb-api/deployment.yaml
    asserts:
      - isKind:
          of: Deployment
      - matchRegex:
          path: metadata.name
          pattern: -api$
      - notEqual:
          path: spec.template.spec.containers[0].image
          value: featurebyte.localhost:10443/featurebyte-server:latest
  - it: api image changes
    template: fb-api/deployment.yaml
    set:
      featurebyte.api.image.repository: "featurebyte.localhost:10443/featurebyte-server"
      featurebyte.api.image.tag: "latest"
    asserts:
      - isKind:
          of: Deployment
      - matchRegex:
          path: metadata.name
          pattern: -api$
      - equal:
          path: spec.template.spec.containers[0].image
          value: featurebyte.localhost:10443/featurebyte-server:latest
